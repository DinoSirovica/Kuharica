<div class="comments-section">
    <h3>Komentari</h3>

    <div class="add-comment" *ngIf="activeUser; else loginPrompt">
        <textarea [(ngModel)]="newCommentText" placeholder="Napišite komentar..." rows="3"></textarea>
        <button (click)="addComment()" [disabled]="!newCommentText.trim()">Objavi komentar</button>
    </div>
    <ng-template #loginPrompt>
        <p class="login-prompt">Morate biti <a routerLink="/profil/prijava">prijavljeni</a> da biste ostavili komentar.
        </p>
    </ng-template>

    <div class="comments-list">
        <div class="comment" *ngFor="let comment of comments">
            <div class="comment-header">
                <strong>{{ comment.korisnik_ime }}</strong>
                <span class="comment-date">{{ comment.datum | date:'dd.MM.yyyy HH:mm' }}</span>
            </div>

            <div *ngIf="!comment.isEditing">
                <p class="comment-text">{{ comment.tekst }}</p>
                <div class="comment-actions">
                    <button class="action-btn edit-btn" *ngIf="canEdit(comment)"
                        (click)="startEdit(comment)">Uredi</button>
                    <button class="action-btn delete-btn" *ngIf="canDelete(comment)"
                        (click)="deleteComment(comment)">Obriši</button>
                </div>
            </div>

            <div *ngIf="comment.isEditing" class="edit-mode">
                <textarea [(ngModel)]="comment.editText" rows="3"></textarea>
                <div class="edit-actions">
                    <button class="save-btn" (click)="saveEdit(comment)">Spremi</button>
                    <button class="cancel-btn" (click)="cancelEdit(comment)">Odustani</button>
                </div>
            </div>

        </div>
        <p *ngIf="comments.length === 0" class="no-comments">Budite prvi koji će komentirati ovaj recept!</p>
    </div>
</div>